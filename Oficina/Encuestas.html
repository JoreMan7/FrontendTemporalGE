<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Encuesta de Habitante - GESTIÓN ECLESIAL</title>
  <link rel="shortcut icon" href="../Img/Logo_Favicon.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="../statics/css/app.css">
  <style>
    /* Agregar en app.css */
.dropdown-menu {
    z-index: 1060;
}

.dropdown-item {
    cursor: pointer;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    padding: 0.5rem 1rem;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item:focus {
    background-color: #0d6efd;
    color: white;
}

/* Agregar en app.css o en el mismo HTML */
#resultadosGrupoFamiliar {
    position: absolute;
    top: 100%; /* Se posiciona justo debajo del input */
    left: 0;
    right: 0;
    z-index: 1060;
    margin-top: 2px; /* Pequeño espacio */
}

/* Asegurar que el contenedor padre tenga posición relativa */
.input-group {
    position: relative;
}

/* CSS para el buscador de grupo familiar */
.input-group {
    position: relative !important;
}

#resultadosGrupoFamiliar {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 1060 !important;
    margin-top: 2px !important;
    display: none;
    max-height: 200px;
    overflow-y: auto;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

/* Estilos para los items del dropdown */
.dropdown-item {
    cursor: pointer;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    padding: 0.5rem 1rem;
    border-bottom: 1px solid #f8f9fa;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.dropdown-item:last-child {
    border-bottom: none;
}
  </style>
</head>

<body class="BodyPlantilla" data-module="encuestaHabitante">
  <!-- Sidebar -->
  <aside class="Sidebar" id="sidebar">
    <div class="LogoContainer">
      <img src="../Img/Logo_(Vertical).png" alt="Eclesial Logo" class="Logo">
    </div>
    <nav class="NavMenu">
      <a href="../NavInicio.html" class="NavItem"><i class="fas fa-home"></i><span class="NavText">Inicio</span></a>
      <a href="../NavOficina.html" class="NavItem active"><i class="bi bi-suitcase-lg-fill"></i><span class="NavText">Oficina</span></a>
      <a href="../NavEstadisticas.html" class="NavItem"><i class="fas fa-calculator"></i><span class="NavText">Estadísticas</span></a>
      <a href="../NavAjustes.html" class="NavItem"><i class="fas fa-cog"></i><span class="NavText">Ajustes</span></a>
      <a href="../About.html" class="NavItem"><i class="bi-info-circle"></i><span class="NavText">Acerca De</span></a>
    </nav>
  </aside>

  <!-- Contenido -->
  <main class="MainContent">
    <header class="TopBar">
      <div class="UserInfo">
        <img src="../Img/sacerdote.jpg" alt="Usuario" class="UserAvatar">
        <div class="UserDetails">
          <h2 class="UserName">Usuario</h2>
          <p class="CurrentDate" id="CurrentDate"></p>
        </div>
      </div>
      <div class="MobileLogo">
        <img src="../Img/Logo_Mobile.png" alt="Logo Eclesial">
      </div>
      <div class="HeaderActions">
        <button class="btn btn-help help">Ayuda</button>
        <div class="Divider"></div>
        <button class="btn btn-logout logout">Cerrar sesión</button>
      </div>
    </header>

    <!-- Título + Volver -->
    <div class="d-flex align-items-center ms-3 mt-3">
      <button id="btnVolver" class="btn btn-outline-secondary btn-sm shadow-sm">
        <i class="fas fa-arrow-left me-1"></i> Volver
      </button>
      <div class="flex-grow-1 text-center">
        <h5 id="pageTitle" class="m-0 fw-bold text-uppercase align-middle">Encuesta del Habitante</h5>
      </div>
      <div class="d-flex align-items-center" style="width: 42px;"></div>
    </div>

    <section class="Content">
      <div class="encuesta-container">
        <!-- WIZARD -->
        <div class="mb-3">
          <div class="progress">
            <div id="wizardProgress" class="progress-bar" role="progressbar" style="width: 25%;"></div>
          </div>
          <small class="text-muted d-block mt-1 text-center">
            <span id="wizardStepLabel">Paso 1 de 4: Identificación</span>
          </small>
        </div>

        <form id="formEncuestaHabitante" class="row g-3 needs-validation" novalidate>
          <!-- ========= 1) IDENTIFICACIÓN ========= -->
          <fieldset class="wizard-step" data-step="1">
            <legend class="h6 fw-bold text-secondary mb-2">
              <i class="bi bi-person-fill me-1"></i>Identificación
            </legend>
            <hr class="mt-0 mb-3">

            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label fw-semibold">Nombre <span class="text-danger">*</span></label>
                <input type="text" id="Nombre" class="form-control" maxlength="100" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Apellido <span class="text-danger">*</span></label>
                <input type="text" id="Apellido" class="form-control" maxlength="100" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Tipo de Documento <span class="text-danger">*</span></label>
                <select id="IdTipoDocumento" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Número de Documento <span class="text-danger">*</span></label>
                <input type="text" id="NumeroDocumento" class="form-control" maxlength="50" required>
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Fecha de Nacimiento <span class="text-danger">*</span></label>
                <input type="date" id="FechaNacimiento" class="form-control" required>
              </div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">Sexo <span class="text-danger">*</span></label>
                <select id="IdSexo" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Estado Civil <span class="text-danger">*</span></label>
                <select id="IdEstadoCivil" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Religión <span class="text-danger">*</span></label>
                <select id="IdReligion" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>

              <!-- Sacramentos opcionales -->
              <div class="col-12">
                <label class="form-label fw-semibold">Sacramentos Recibidos</label>
                <div id="SacramentosWrap" class="row">
                  <!-- Se llena dinámicamente -->
                </div>
              </div>



<!-- Grupo Familiar - Búsqueda dinámica -->
<div class="col-12">
    <label class="form-label fw-semibold">Grupo Familiar <span class="text-danger">*</span></label>
    
    <!-- Contenedor principal con posición relativa -->
    <div style="position: relative;">
        <div class="input-group">
            <input type="text" 
                   id="BuscarGrupoFamiliar" 
                   class="form-control" 
                   placeholder="Buscar grupo familiar existente o crear uno nuevo..." 
                   autocomplete="off"
                   required>
            <button class="btn btn-outline-secondary" type="button" id="btnLimpiarBusqueda">
                <i class="bi bi-x-circle"></i>
            </button>
        </div>
        
        <!-- Contenedor de resultados - POSICIONADO ABSOLUTAMENTE -->
        <div id="resultadosGrupoFamiliar" 
             style="position: absolute; top: 100%; left: 0; right: 0; z-index: 1060; display: none; background: white; border: 1px solid #dee2e6; border-radius: 0.375rem; box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); max-height: 200px; overflow-y: auto;">
            <!-- Los resultados se insertarán aquí dinámicamente -->
        </div>
    </div>
    
    <input type="hidden" id="IdGrupoFamiliar" name="IdGrupoFamiliar" required>
    <div id="infoGrupoSeleccionado" class="alert alert-info mt-2" style="display: none;">
        <i class="bi bi-check-circle me-1"></i>
        <span id="textoGrupoSeleccionado"></span>
    </div>
    <div class="form-text">
        Escribe para buscar grupos existentes. Si no existe, podrás crear uno nuevo.
    </div>
</div>

              <div class="col-md-4">
                <label class="form-label fw-semibold">¿Tiene hijos?</label>
                <input type="number" id="Hijos" class="form-control" min="0" value="0">
              </div>
            </div>
          </fieldset>

          <!-- ========= 2) CONTACTO Y UBICACIÓN ========= -->
          <fieldset class="wizard-step" data-step="2" style="display:none;">
            <legend class="h6 fw-bold text-secondary mb-2">
              <i class="bi bi-geo-alt-fill me-1"></i>Contacto y Ubicación
            </legend>
            <hr class="mt-0 mb-3">

            <div class="row g-3">
              <div class="col-md-8">
                <label class="form-label fw-semibold">Dirección <span class="text-danger">*</span></label>
                <input type="text" id="Direccion" class="form-control" maxlength="255" required>
              </div>
              <div class="col-md-4">
                <label class="form-label fw-semibold">Teléfono <span class="text-danger">*</span></label>
                <input type="text" id="Telefono" class="form-control" maxlength="20" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Correo Electrónico <span class="text-danger">*</span></label>
                <input type="email" id="CorreoElectronico" class="form-control" maxlength="100" required>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Sector <span class="text-danger">*</span></label>
                <select id="IdSector" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label fw-semibold">Tipo de Población <span class="text-danger">*</span></label>
                <select id="IdTipoPoblacion" class="form-select" required>
                  <option value="">Seleccione...</option>
                </select>
              </div>
            </div>
          </fieldset>

          <!-- ========= 3) SALUD ========= -->
<!-- ========= 3) SALUD ========= -->
<fieldset class="wizard-step" data-step="3" style="display:none;">
  <legend class="h6 fw-bold text-secondary mb-2">
    <i class="bi bi-heart-pulse me-1"></i>Salud
  </legend>
  <hr class="mt-0 mb-3">

  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label fw-semibold">¿Tiene impedimento de salud? <span class="text-danger">*</span></label>
      <select id="TieneImpedimentoSalud" class="form-select" required>
        <option value="0">No</option>
        <option value="1">Sí</option>
      </select>
    </div>
    <div class="col-md-8">
      <label class="form-label fw-semibold">Motivo del impedimento</label>
      <textarea id="MotivoImpedimentoSalud" class="form-control" rows="2" placeholder="Describa el impedimento..."></textarea>
    </div>

    <div class="col-md-6">
      <label class="form-label fw-semibold">Discapacidad para asistir</label>
      <select id="DiscapacidadParaAsistir" class="form-select">
        <option value="Ninguna" selected>Ninguna</option>
        <option value="Visual">Visual</option>
        <option value="Auditiva">Auditiva</option>
        <option value="Motriz">Motriz</option>
        <option value="Otra">Otra</option>
      </select>
    </div>
    <div class="col-md-6" id="DiscapacidadOtraWrap" style="display:none;">
      <label class="form-label fw-semibold">Especifique la discapacidad</label>
      <input type="text" id="DiscapacidadOtra" class="form-control" maxlength="255" placeholder="¿Cuál?">
    </div>
  </div>

  <!-- Botones de acción -->
  <div class="text-end mt-4">
    <button type="reset" class="btn btn-outline-secondary me-2">
      <i class="bi bi-eraser me-1"></i>Limpiar
    </button>
    <button type="submit" id="btnGuardar" class="btn btn-success">
      <i class="bi bi-save2 me-1"></i>Guardar Encuesta
    </button>
  </div>
</fieldset>

          <!-- Navegación Wizard -->
          <div class="d-flex justify-content-between mt-3">
            <button type="button" id="btnPrev" class="btn btn-outline-secondary"><i class="bi bi-chevron-left"></i> Atrás</button>
            <button type="button" id="btnNext" class="btn btn-primary">Siguiente <i class="bi bi-chevron-right"></i></button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script type="module" src="../statics/js/app.js"></script>
</body>
</html>
